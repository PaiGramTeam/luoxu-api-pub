var Re=Object.defineProperty;var Ie=(t,e,n)=>e in t?Re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var re=(t,e,n)=>(Ie(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&l(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function j(){}function Me(t){return t()}function ye(){return Object.create(null)}function B(t){t.forEach(Me)}function Ue(t){return typeof t=="function"}function ae(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let ne;function J(t,e){return t===e?!0:(ne||(ne=document.createElement("a")),ne.href=e,t===ne.href)}function Pe(t){return Object.keys(t).length===0}function g(t,e){t.appendChild(e)}function U(t,e,n){t.insertBefore(e,n||null)}function O(t){t.parentNode&&t.parentNode.removeChild(t)}function qe(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function v(t){return document.createElement(t)}function H(t){return document.createTextNode(t)}function T(){return H(" ")}function _e(){return H("")}function N(t,e,n,l){return t.addEventListener(e,n,l),()=>t.removeEventListener(e,n,l)}function Be(t){return function(e){return e.preventDefault(),t.call(this,e)}}function p(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function He(t){return Array.from(t.childNodes)}function x(t,e){e=""+e,t.data!==e&&(t.data=e)}function Q(t,e){t.value=e??""}function ve(t,e,n){for(let l=0;l<t.options.length;l+=1){const s=t.options[l];if(s.__value===e){s.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function Xe(t){const e=t.querySelector(":checked");return e&&e.__value}function se(t,e,n){t.classList.toggle(e,!!n)}let ee;function $(t){ee=t}function de(){if(!ee)throw new Error("Function called outside component initialization");return ee}function Ne(t){de().$$.on_mount.push(t)}function Ke(t,e){return de().$$.context.set(t,e),e}function ue(t){return de().$$.context.get(t)}const G=[],te=[];let V=[];const ce=[],ze=Promise.resolve();let fe=!1;function Ge(){fe||(fe=!0,ze.then(je))}function oe(t){V.push(t)}function Ve(t){ce.push(t)}const ie=new Set;let z=0;function je(){if(z!==0)return;const t=ee;do{try{for(;z<G.length;){const e=G[z];z++,$(e),We(e.$$)}}catch(e){throw G.length=0,z=0,e}for($(null),G.length=0,z=0;te.length;)te.pop()();for(let e=0;e<V.length;e+=1){const n=V[e];ie.has(n)||(ie.add(n),n())}V.length=0}while(G.length);for(;ce.length;)ce.pop()();fe=!1,ie.clear(),$(t)}function We(t){if(t.fragment!==null){t.update(),B(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(oe)}}function Je(t){const e=[],n=[];V.forEach(l=>t.indexOf(l)===-1?e.push(l):n.push(l)),n.forEach(l=>l()),V=e}const le=new Set;let X;function Fe(){X={r:0,c:[],p:X}}function Se(){X.r||B(X.c),X=X.p}function P(t,e){t&&t.i&&(le.delete(t),t.i(e))}function W(t,e,n,l){if(t&&t.o){if(le.has(t))return;le.add(t),X.c.push(()=>{le.delete(t),l&&(n&&t.d(1),l())}),t.o(e)}else l&&l()}function Y(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function Qe(t,e){t.d(1),e.delete(t.key)}function Ye(t,e,n,l,s,i,o,r,u,_,h,f){let d=t.length,w=i.length,a=d;const m={};for(;a--;)m[t[a].key]=a;const k=[],q=new Map,L=new Map,E=[];for(a=w;a--;){const y=f(s,i,a),A=n(y);let M=o.get(A);M?l&&E.push(()=>M.p(y,e)):(M=_(A,y),M.c()),q.set(A,k[a]=M),A in m&&L.set(A,Math.abs(a-m[A]))}const R=new Set,C=new Set;function D(y){P(y,1),y.m(r,h),o.set(y.key,y),h=y.first,w--}for(;d&&w;){const y=k[w-1],A=t[d-1],M=y.key,S=A.key;y===A?(h=y.first,d--,w--):q.has(S)?!o.has(M)||R.has(M)?D(y):C.has(S)?d--:L.get(M)>L.get(S)?(C.add(M),D(y)):(R.add(S),d--):(u(A,o),d--)}for(;d--;){const y=t[d];q.has(y.key)||u(y,o)}for(;w;)D(k[w-1]);return B(E),k}function Ze(t,e,n){const l=t.$$.props[e];l!==void 0&&(t.$$.bound[l]=n,n(t.$$.ctx[l]))}function Te(t){t&&t.c()}function he(t,e,n){const{fragment:l,after_update:s}=t.$$;l&&l.m(e,n),oe(()=>{const i=t.$$.on_mount.map(Me).filter(Ue);t.$$.on_destroy?t.$$.on_destroy.push(...i):B(i),t.$$.on_mount=[]}),s.forEach(oe)}function pe(t,e){const n=t.$$;n.fragment!==null&&(Je(n.after_update),B(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function $e(t,e){t.$$.dirty[0]===-1&&(G.push(t),Ge(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function ge(t,e,n,l,s,i,o=null,r=[-1]){const u=ee;$(t);const _=t.$$={fragment:null,ctx:[],props:i,update:j,not_equal:s,bound:ye(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(u?u.$$.context:[])),callbacks:ye(),dirty:r,skip_bound:!1,root:e.target||u.$$.root};o&&o(_.root);let h=!1;if(_.ctx=n?n(t,e.props||{},(f,d,...w)=>{const a=w.length?w[0]:d;return _.ctx&&s(_.ctx[f],_.ctx[f]=a)&&(!_.skip_bound&&_.bound[f]&&_.bound[f](a),h&&$e(t,f)),d}):[],_.update(),h=!0,B(_.before_update),_.fragment=l?l(_.ctx):!1,e.target){if(e.hydrate){const f=He(e.target);_.fragment&&_.fragment.l(f),f.forEach(O)}else _.fragment&&_.fragment.c();e.intro&&P(t.$$.fragment),he(t,e.target,e.anchor),je()}$(u)}class me{constructor(){re(this,"$$");re(this,"$$set")}$destroy(){pe(this,1),this.$destroy=j}$on(e,n){if(!Ue(n))return j;const l=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return l.push(n),()=>{const s=l.indexOf(n);s!==-1&&l.splice(s,1)}}$set(e){this.$$set&&!Pe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const xe="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(xe);function et(t){let e,n,l,s,i,o,r,u=(t[0].from_name||" ")+"",_,h,f,d=t[0].html+"",w,a,m=t[1][t[0].group_id][1]+"",k,q,L,E,R;return{c(){e=v("div"),n=v("img"),i=T(),o=v("div"),r=v("div"),_=H(u),h=T(),f=v("div"),w=T(),a=v("div"),k=H(m),q=T(),L=v("a"),E=v("time"),R=H(t[3]),p(n,"class","avatar svelte-15hb0c4"),J(n.src,l=ue("LUOXU_URL")+"/avatar/"+t[0].from_id+".jpg")||p(n,"src",l),p(n,"height","64"),p(n,"width","64"),p(n,"alt",s=t[0].from_name+" 的头像"),p(r,"class","name svelte-15hb0c4"),p(f,"class","text svelte-15hb0c4"),p(E,"datetime",t[4]),p(E,"title",t[2]),p(L,"href",t[5]),p(L,"class","svelte-15hb0c4"),p(a,"class","time svelte-15hb0c4"),p(o,"class","content svelte-15hb0c4"),p(e,"class","message svelte-15hb0c4")},m(C,D){U(C,e,D),g(e,n),g(e,i),g(e,o),g(o,r),g(r,_),g(o,h),g(o,f),f.innerHTML=d,g(o,w),g(o,a),g(a,k),g(a,q),g(a,L),g(L,E),g(E,R)},p(C,[D]){D&1&&!J(n.src,l=ue("LUOXU_URL")+"/avatar/"+C[0].from_id+".jpg")&&p(n,"src",l),D&1&&s!==(s=C[0].from_name+" 的头像")&&p(n,"alt",s),D&1&&u!==(u=(C[0].from_name||" ")+"")&&x(_,u),D&1&&d!==(d=C[0].html+"")&&(f.innerHTML=d),D&3&&m!==(m=C[1][C[0].group_id][1]+"")&&x(k,m)},i:j,o:j,d(C){C&&O(e)}}}function tt(t,e){const n={year:31536e6,month:2628e6,day:864e5,hour:36e5,minute:6e4,second:1e3},l=new Intl.RelativeTimeFormat,s=t.valueOf()-e.valueOf();for(const[i,o]of Object.entries(n))if(Math.abs(s)>o||i==="second")return l.format(Math.round(s/o),i)}function nt(t,e,n){let{msg:l}=e,{groupinfo:s}=e,{now:i}=e;const r=new Intl.DateTimeFormat(void 0,{timeStyle:"full",dateStyle:"full",hour12:!1}).format;let u=new Date(l.t*1e3),_=l.edited?new Date(l.edited*1e3):null,h=r(u)+(_?`
最后编辑于：${r(_)}`:""),f=tt(u,i),d=u.toISOString(),w=s[l.group_id][0]?`tg://resolve?domain=${s[l.group_id][0]}&post=${l.id}`:`tg://privatepost?channel=${l.group_id}&post=${l.id}`;return t.$$set=a=>{"msg"in a&&n(0,l=a.msg),"groupinfo"in a&&n(1,s=a.groupinfo),"now"in a&&n(6,i=a.now)},[l,s,h,f,d,w,i]}class lt extends me{constructor(e){super(),ge(this,e,nt,et,ae,{msg:0,groupinfo:1,now:6})}}function ke(t,e,n){const l=t.slice();return l[25]=e[n],l[27]=n,l}function Ee(t,e){let n,l,s,i=e[25][1]+"",o,r,u,_;return{key:t,first:null,c(){n=v("li"),l=v("img"),o=H(i),r=T(),J(l.src,s=e[6]+"/avatar/"+e[25][0]+".jpg")||p(l,"src",s),p(l,"alt","avatar"),p(l,"class","svelte-179qc5o"),p(n,"data-idx",u=e[27]),p(n,"title",_=e[25][1]),p(n,"class","svelte-179qc5o"),se(n,"selected",e[27]===e[1]),this.first=n},m(h,f){U(h,n,f),g(n,l),g(n,o),g(n,r)},p(h,f){e=h,f&4&&!J(l.src,s=e[6]+"/avatar/"+e[25][0]+".jpg")&&p(l,"src",s),f&4&&i!==(i=e[25][1]+"")&&x(o,i),f&4&&u!==(u=e[27])&&p(n,"data-idx",u),f&4&&_!==(_=e[25][1])&&p(n,"title",_),f&6&&se(n,"selected",e[27]===e[1])},d(h){h&&O(n)}}}function st(t){let e,n,l,s,i,o,r,u=[],_=new Map,h,f,d=Y(t[2]);const w=a=>a[25];for(let a=0;a<d.length;a+=1){let m=ke(t,d,a),k=w(m);_.set(k,u[a]=Ee(k,m))}return{c(){e=v("div"),n=v("input"),l=T(),s=v("img"),o=T(),r=v("ul");for(let a=0;a<u.length;a+=1)u[a].c();p(n,"type","text"),p(n,"class","svelte-179qc5o"),p(s,"class","selected-avatar svelte-179qc5o"),p(s,"alt",""),J(s.src,i=t[6]+"/avatar/"+(t[0]?t[0]:"nobody")+".jpg")||p(s,"src",i),p(r,"class","svelte-179qc5o"),se(r,"hidden",t[2].length===0||t[5]),p(e,"class","svelte-179qc5o")},m(a,m){U(a,e,m),g(e,n),t[14](n),g(e,l),g(e,s),g(e,o),g(e,r);for(let k=0;k<u.length;k+=1)u[k]&&u[k].m(r,null);t[18](r),h||(f=[N(window,"resize",t[7]),N(n,"input",t[15]),N(n,"focus",t[16]),N(n,"blur",t[17]),N(n,"keydown",t[11]),N(r,"click",t[9]),N(r,"mousedown",Be(ot))],h=!0)},p(a,[m]){m&1&&!J(s.src,i=a[6]+"/avatar/"+(a[0]?a[0]:"nobody")+".jpg")&&p(s,"src",i),m&70&&(d=Y(a[2]),u=Ye(u,m,w,1,a,d,_,r,Qe,Ee,null,ke)),m&36&&se(r,"hidden",a[2].length===0||a[5])},i:j,o:j,d(a){a&&O(e),t[14](null);for(let m=0;m<u.length;m+=1)u[m].d();t[18](null),h=!1,B(f)}}}const ot=()=>{};function rt(t,e,n){let{group:l}=e,{selected:s}=e,{selected_init:i}=e,o="",r,u,_=[],h=ue("LUOXU_URL"),f,d,w=!1,a=new AbortController;Ne(()=>{const c=f.getBoundingClientRect();n(4,d.style.top=`${c.height-1}px`,d),n(4,d.style.width=`${c.width-2}px`,d)});function m(){const c=f.getBoundingClientRect();n(4,d.style.width=`${c.width-2}px`,d)}function k(){u&&clearTimeout(u),u=setTimeout(function(){q()},300)}async function q(){if(f.value){n(1,r=null),a.abort(),a=new AbortController;try{const b=await(await fetch(`${h}/names?g=${l}&q=${f.value}`,{signal:a.signal})).json();a.signal.aborted||n(2,_=b.names)}catch(c){c instanceof DOMException&&c.name==="AbortError"||console.error(c)}}}function L(c){let b=c.target;b.tagName==="IMG"&&(b=b.parentNode),b.tagName=="LI"&&(n(1,r=parseInt(b.dataset.idx)),E(),f.focus(),n(5,w=!0))}function E(){n(0,s=_[r][0]),o=_[r][1],n(3,f.value=o,f),n(12,i=null)}function R(){!s||s===i||(f.value?n(3,f.value=o,f):(n(0,s=i),o=""))}function C(c){c.key==="ArrowDown"||c.key==="n"&&c.altKey?(D(1),c.preventDefault()):c.key==="ArrowUp"||c.key==="p"&&c.altKey?(D(-1),c.preventDefault()):c.key==="Enter"&&(E(),c.preventDefault())}function D(c){typeof r=="number"?c>0?n(1,r=(r+1)%_.length):n(1,r=(r-1)%_.length):c>0?n(1,r=0):n(1,r=_.length-1)}function y(c){te[c?"unshift":"push"](()=>{f=c,n(3,f)})}const A=()=>{n(5,w=!1),k()},M=()=>n(5,w=!1),S=()=>{n(5,w=!0),R()};function F(c){te[c?"unshift":"push"](()=>{d=c,n(4,d)})}return t.$$set=c=>{"group"in c&&n(13,l=c.group),"selected"in c&&n(0,s=c.selected),"selected_init"in c&&n(12,i=c.selected_init)},[s,r,_,f,d,w,h,m,k,L,R,C,i,l,y,A,M,S,F]}class it extends me{constructor(e){super(),ge(this,e,rt,st,ae,{group:13,selected:0,selected_init:12})}}function ut(t){return new Promise((n,l)=>{setTimeout(n,t)})}function Le(t,e,n){const l=t.slice();return l[25]=e[n],l}function Ce(t,e,n){const l=t.slice();return l[2]=e[n],l}function ct(t){let e,n,l,s,i=t[10]&&at(),o=Y(t[0]),r=[];for(let u=0;u<o.length;u+=1)r[u]=De(Ce(t,o,u));return{c(){e=v("select"),i&&i.c(),n=_e();for(let u=0;u<r.length;u+=1)r[u].c();t[2]===void 0&&oe(()=>t[17].call(e))},m(u,_){U(u,e,_),i&&i.m(e,null),g(e,n);for(let h=0;h<r.length;h+=1)r[h]&&r[h].m(e,null);ve(e,t[2],!0),l||(s=[N(e,"change",t[17]),N(e,"change",t[13])],l=!0)},p(u,_){if(_&1){o=Y(u[0]);let h;for(h=0;h<o.length;h+=1){const f=Ce(u,o,h);r[h]?r[h].p(f,_):(r[h]=De(f),r[h].c(),r[h].m(e,null))}for(;h<r.length;h+=1)r[h].d(1);r.length=o.length}_&5&&ve(e,u[2])},d(u){u&&O(e),i&&i.d(),qe(r,u),l=!1,B(s)}}}function ft(t){let e,n;return{c(){e=v("select"),n=v("option"),n.textContent="正在加载群组信息...",n.selected=!0,n.__value="正在加载群组信息...",Q(n,n.__value)},m(l,s){U(l,e,s),g(e,n)},p:j,d(l){l&&O(e)}}}function at(t){let e;return{c(){e=v("option"),e.textContent="全部",e.__value="",Q(e,e.__value)},m(n,l){U(n,e,l)},d(n){n&&O(e)}}}function De(t){let e,n=t[2].name+"",l,s;return{c(){e=v("option"),l=H(n),e.__value=s=t[2].group_id,Q(e,e.__value)},m(i,o){U(i,e,o),g(e,l)},p(i,o){o&1&&n!==(n=i[2].name+"")&&x(l,n),o&1&&s!==(s=i[2].group_id)&&(e.__value=s,Q(e,e.__value))},d(i){i&&O(e)}}}function _t(t){let e;return{c(){e=v("div"),e.innerHTML=`<p>搜索消息时，搜索字符串不区分简繁（会使用 OpenCC
        自动转换），也不进行分词（请手动将可能不连在一起的词语以空格分开）。</p> <p>搜索字符串支持以下功能：</p> <ul><li>以空格分开的多个搜索词是「与」的关系</li> <li>使用 OR（全大写）来表达「或」条件</li> <li>使用 - 来表达排除，如 落絮 - 测试</li> <li>使用小括号来分组</li></ul> <p>人名补全支持上下方向键和 Alt+N/P 进行选择。</p> <p>搜索结果右下角的时间，悬停可查看绝对时间、最后编辑时间（如编辑过），点击可跳转到
        Telegram 中展示该消息。</p>`},m(n,l){U(n,e,l)},p:j,i:j,o:j,d(n){n&&O(e)}}}function dt(t){let e,n,l=Y(t[4].messages),s=[];for(let o=0;o<l.length;o+=1)s[o]=Oe(Le(t,l,o));const i=o=>W(s[o],1,1,()=>{s[o]=null});return{c(){for(let o=0;o<s.length;o+=1)s[o].c();e=_e()},m(o,r){for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(o,r);U(o,e,r),n=!0},p(o,r){if(r&48){l=Y(o[4].messages);let u;for(u=0;u<l.length;u+=1){const _=Le(o,l,u);s[u]?(s[u].p(_,r),P(s[u],1)):(s[u]=Oe(_),s[u].c(),P(s[u],1),s[u].m(e.parentNode,e))}for(Fe(),u=l.length;u<s.length;u+=1)i(u);Se()}},i(o){if(!n){for(let r=0;r<l.length;r+=1)P(s[r]);n=!0}},o(o){s=s.filter(Boolean);for(let r=0;r<s.length;r+=1)W(s[r]);n=!1},d(o){o&&O(e),qe(s,o)}}}function Oe(t){let e,n;return e=new lt({props:{msg:t[25],groupinfo:t[4].groupinfo,now:t[5]}}),{c(){Te(e.$$.fragment)},m(l,s){he(e,l,s),n=!0},p(l,s){const i={};s&16&&(i.msg=l[25]),s&16&&(i.groupinfo=l[4].groupinfo),s&32&&(i.now=l[5]),e.$set(i)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){W(e.$$.fragment,l),n=!1},d(l){pe(e,l)}}}function ht(t){let e,n;function l(r,u){if(r[3])return bt;if(r[4]&&r[4].messages.length===0)return mt;if(r[4]&&!r[4].has_more)return gt}let s=l(t),i=s&&s(t),o=t[4]&&t[4].has_more&&Ae(t);return{c(){i&&i.c(),e=T(),o&&o.c(),n=_e()},m(r,u){i&&i.m(r,u),U(r,e,u),o&&o.m(r,u),U(r,n,u)},p(r,u){s===(s=l(r))&&i?i.p(r,u):(i&&i.d(1),i=s&&s(r),i&&(i.c(),i.m(e.parentNode,e))),r[4]&&r[4].has_more?o?o.p(r,u):(o=Ae(r),o.c(),o.m(n.parentNode,n)):o&&(o.d(1),o=null)},d(r){r&&(O(e),O(n)),i&&i.d(r),o&&o.d(r)}}}function pt(t){let e;return{c(){e=v("div"),e.innerHTML='<p class="svelte-cd7t1">正在加载...</p>',p(e,"class","info svelte-cd7t1")},m(n,l){U(n,e,l)},p:j,d(n){n&&O(e)}}}function gt(t){let e;return{c(){e=v("div"),e.innerHTML='<p class="svelte-cd7t1">到底了。</p>',p(e,"class","info svelte-cd7t1")},m(n,l){U(n,e,l)},p:j,d(n){n&&O(e)}}}function mt(t){let e;return{c(){e=v("div"),e.innerHTML='<p class="svelte-cd7t1">没有匹配的消息。</p>',p(e,"class","info svelte-cd7t1")},m(n,l){U(n,e,l)},p:j,d(n){n&&O(e)}}}function bt(t){let e,n;return{c(){e=v("p"),n=H(t[3]),p(e,"class","error svelte-cd7t1")},m(l,s){U(l,e,s),g(e,n)},p(l,s){s&8&&x(n,l[3])},d(l){l&&O(e)}}}function Ae(t){let e,n,l,s;return{c(){e=v("div"),n=v("button"),n.textContent="加载更多",p(n,"class","svelte-cd7t1"),p(e,"class","info svelte-cd7t1")},m(i,o){U(i,e,o),g(e,n),l||(s=N(n,"click",t[14]),l=!0)},p:j,d(i){i&&O(e),l=!1,s()}}}function wt(t){let e,n,l,s,i,o,r,u,_,h,f,d,w,a,m,k;function q(c,b){return c[0].length===0?ft:ct}let L=q(t),E=L(t);function R(c){t[21](c)}let C={group:t[2],selected_init:t[8]};t[7]!==void 0&&(C.selected=t[7]),o=new it({props:C}),te.push(()=>Ze(o,"selected",R));const D=[dt,_t],y=[];function A(c,b){return c[4]?0:!c[6]&&!c[3]?1:-1}~(f=A(t))&&(d=y[f]=D[f](t));function M(c,b){return c[6]?pt:ht}let S=M(t),F=S(t);return{c(){e=v("main"),n=v("div"),E.c(),l=T(),s=v("input"),i=T(),Te(o.$$.fragment),u=T(),_=v("button"),_.textContent="搜索",h=T(),d&&d.c(),w=T(),F.c(),p(s,"type","search"),p(s,"class","svelte-cd7t1"),p(_,"class","svelte-cd7t1"),p(n,"id","searchbox"),p(n,"class","svelte-cd7t1"),p(e,"class","svelte-cd7t1")},m(c,b){U(c,e,b),g(e,n),E.m(n,null),g(n,l),g(n,s),Q(s,t[1]),g(n,i),he(o,n,null),g(n,u),g(n,_),g(e,h),~f&&y[f].m(e,null),g(e,w),F.m(e,null),a=!0,m||(k=[N(window,"hashchange",t[16]),N(s,"input",t[18]),N(s,"input",t[19]),N(s,"keydown",t[20]),N(_,"click",t[22])],m=!0)},p(c,[b]){L===(L=q(c))&&E?E.p(c,b):(E.d(1),E=L(c),E&&(E.c(),E.m(n,l))),b&2&&s.value!==c[1]&&Q(s,c[1]);const I={};b&4&&(I.group=c[2]),b&256&&(I.selected_init=c[8]),!r&&b&128&&(r=!0,I.selected=c[7],Ve(()=>r=!1)),o.$set(I);let K=f;f=A(c),f===K?~f&&y[f].p(c,b):(d&&(Fe(),W(y[K],1,1,()=>{y[K]=null}),Se()),~f?(d=y[f],d?d.p(c,b):(d=y[f]=D[f](c),d.c()),P(d,1),d.m(e,w)):d=null),S===(S=M(c))&&F?F.p(c,b):(F.d(1),F=S(c),F&&(F.c(),F.m(e,null)))},i(c){a||(P(o.$$.fragment,c),P(d),a=!0)},o(c){W(o.$$.fragment,c),W(d),a=!1},d(c){c&&O(e),E.d(),pe(o),~f&&y[f].d(),F.d(),m=!1,B(k)}}}const Z="https://search-pub.xtaolabs.com/luoxu";function yt(){const t=location.hash;if(t)return new URLSearchParams(t.substring(1))}function vt(t,e,n){const l=Z.startsWith("http://localhost");let s=[],i,o,r,u,_=new Date,h=!1,f=!1,d,w,a=!1,m=new AbortController;Ke("LUOXU_URL",Z),Ne(async()=>{for(k();;)try{const c=await fetch(`${Z}/groups`);n(0,s=(await c.json()).groups),n(15,f=!0),i||n(2,i="");break}catch(c){console.error("failed to fetch group info, will retry",c),await ut(1e3)}});function k(){const c=yt();c&&(n(1,o=""),n(2,i=""),n(4,u=null),c.has("g")&&n(2,i=c.get("g")),c.has("q")&&n(1,o=c.get("q")),c.has("sender")&&(n(7,d=c.get("sender")),n(8,w=d)),(i||l)&&o&&(n(4,u=null),L()))}let q=0;async function L(c){q+=1;try{if(m.abort(),m=new AbortController,!i&&!l){n(3,r="请选择要搜索的群组");return}if(!o&&!l&&!d){n(3,r="请输入搜索关键字");return}n(3,r=""),n(9,a=!0),console.log(`searching ${o} for group ${i}, older than ${c}, from ${d}`);const b=new URLSearchParams;i&&b.append("g",i),o&&b.append("q",o),d&&b.append("sender",d);let I;const K=b.toString();c?I=`${Z}/search?${b}&end=${c}`:(location.hash=`#${K}`,n(15,f=!0),u&&n(4,u.messages=[],u),I=`${Z}/search?${K}`),n(5,_=new Date),n(6,h=!0);try{const we=await(await fetch(I,{signal:m.signal})).json();if(n(6,h=!1),m.signal.aborted)return[];if(c)return we;n(4,u=we)}catch(be){q<=1&&(n(3,r=be),n(6,h=!1))}n(9,a=!1)}finally{q-=1}}async function E(){n(3,r=""),o&&await L()}async function R(){const c=u.messages[u.messages.length-1].t,b=u.messages,I=await L(c);n(4,u.messages=[...b,...I.messages],u),n(4,u.has_more=I.has_more,u)}const C=()=>{a||k()};function D(){i=Xe(this),n(2,i),n(0,s)}function y(){o=this.value,n(1,o)}const A=()=>n(3,r=""),M=c=>{c.key==="Enter"&&L()};function S(c){d=c,n(7,d)}const F=()=>L();return t.$$.update=()=>{if(t.$$.dirty&32775&&f&&s){let c;for(const b of s)b.group_id===i&&(c=b.name);o&&c?document.title=`搜索：${o} 于 ${c} - 落絮`:o?document.title=`搜索：${o} - 落絮`:c?document.title=`搜索 ${c} - 落絮`:document.title="落絮",n(15,f=!1)}},[s,o,i,r,u,_,h,d,w,a,l,k,L,E,R,f,C,D,y,A,M,S,F]}class kt extends me{constructor(e){super(),ge(this,e,vt,wt,ae,{})}}new kt({target:document.body});
